var changeImgs=function(){$(".tip-image").find("img").each(function(){var a=$(this).attr("src");$(this).attr("data-src",a),$(this).removeAttr("src")})};changeImgs(),$(".overlay").attr("hidden","true").find(".overlay-inner").find("form").after('<a href="#" class="overlay-hide"><span>Hide window</span></a>'),$(".button-search").remove(),$(".main-main-in").prepend('<div id="js-searchcontainer"></div>');var removeFocus=function(){$("a").removeAttr("tabindex"),$(".tip_version_in").attr("tabindex","0"),$(".noFocus").find("a, input, button, textarea, .overlay-title").attr("tabindex","-1"),$(".overlay").attr("hidden","true")},setFocus=function(a){$("a").attr("tabindex","-1"),$(a).find("a, input, button, textarea, .overlay-title").removeAttr("tabindex"),$(a).removeAttr("hidden")},setActive=function(a){"#overlay-search"==a?$(a).find("input").focus():"#overlay-contact"==a&&$("#overlay-contact-label").attr("tabindex","0").focus()},hideOverlay=function(){var a=window.location.hash;window.location.hash="",$("a[href="+a+"]").focus(),$(".main-header-nav-item").removeClass("selected"),removeFocus();var b=getcount("search");"#overlay-search"==a&&0==b?($("#js-searchinput").val(""),$("#js-searchcount").remove(),$("#js-searchcontainer").empty(),$(".main-main-in").find("article").removeClass("js-hidden"),setTimeout(function(){$(".main-main-in").find("article").removeClass("js-faded"),0==$(".main-main-in").find(".message-error").length&&$(".main-main-in").prepend('<p class="message message-fullwidth message-error animation-shake">No tips matched your search term. Please try again. <a href="#" class="hide-icon"><span>Hide message</span></a></p>')},300)):"#overlay-contact"==a&&($("input, textarea").val(""),$("#js-contactmessage").remove(),$("input, textarea").removeClass("user-success"))};$("body").on("click",".message .hide-icon",function(){$(this).parent().fadeOut(function(){$(this).remove()})}),removeFocus();var loadWebshims=function(a){"#overlay-contact"==a&&$.getScript("js/js-webshim/minified/polyfiller.js",function(){$.webshims.setOptions({waitReady:!1,basePath:"js/js-webshim/minified/shims/"}),$.webshims.setOptions("forms",{customMessages:!0,replaceValidationUI:!0}),$.webshims.polyfill("forms")})},hash=window.location.hash;""!=hash&&($(".main-header-nav-item").find("a[href="+hash+"]").parent().addClass("selected"),setFocus(hash),setActive(hash),loadWebshims(hash)),$(".main-header-nav-item").on("click","a",function(a){var b=$(this).attr("href"),c=window.location.hash;loadWebshims(b),b==c?(hideOverlay(),a.preventDefault()):(removeFocus(),$(".tip-menu").length>0&&hideMenu(),setFocus(b),$(this).parent().addClass("selected").siblings().removeClass("selected"),setActive(b))}),$(document).keydown(function(a){var b=window.location.hash;27==a.which?(("#overlay-contact"==b||"#overlay-search"==b)&&hideOverlay(),$(".tip-menu").length>0&&hideMenu()):13==a.which&&"#overlay-search"==b&&hideOverlay()}),$(".overlay").on("click",".overlay-hide",function(){hideOverlay()}),$(".form-row-radio-item").find("label").on("click",function(){var a=$(this).attr("for");"send-sug"==a?$(".overlay-contact").find("[for=msg]").text("Your tip").end().find(".overlay-contact-hint").fadeIn():"send-msg"==a&&$(".overlay-contact").find("[for=msg]").text("Your message").end().find(".overlay-contact-hint").fadeOut()}),$("#js-overlay-contact-form").submit(function(a){a.preventDefault(),$.post("process.php",{event:"email",contacttype:$(".overlay-contact").find("[name=contact-type]:checked").val(),name:$(".overlay-contact").find("[name=name]").val(),email:$(".overlay-contact").find("[name=email]").val(),msg:$(".overlay-contact").find("[name=msg]").val()},function(a){$(".overlay-contact").find("form").prepend('<p class="message message-dark message-success" id="js-contactmessage">'+a+"</p>"),$("html, body").animate({scrollTop:0},"slow")}).error(function(){$(".overlay-contact").find("form").prepend('<p class="message message-dark message-error" id="js-contactmessage">An error has occured. Please try again.</p>')})});var getcount=function(a){if("tips"==a)var b="tipscount";if("search"==a)var b="searchcount";var c;return $.ajax({type:"POST",url:"process.php",async:!1,data:{event:b,searchterm:$("[name=searchterm]").val()},success:function(a){c=a}}),c},loc=window.location.href,locPos=loc.substr(loc.indexOf("count")+6);startTips=loc.indexOf("count")>0?locPos:5;var startTips=parseInt(startTips,10),countTips=5,getTips=function(a){$.post("process.php",{event:"loadmore",start:startTips,count:countTips},function(b){$(a).before(b),setTimeout(function(){$(".js-faded").removeClass("js-faded")},300),$(a).removeClass("is-active"),startTips+=countTips;var c=getcount("tips");startTips>=c&&$(".loadmore").hide()}).error(function(){$(a).before('<p class="message message-error">An error has occured. Please try again.</p>')})};$("#js-loadmore").on("click",function(a){var b=$(this);$(b).addClass("is-active"),setTimeout(function(){getTips(b)},1e3);var c="?count="+(startTips+countTips);history.pushState({},"",c),a.preventDefault()});var searchTips=function(){$.post("process.php",{event:"search",searchterm:$("[name=searchterm]").val()},function(a){$(".main-main-in > article, .main-main-in #js-loadmore").addClass("js-faded js-hidden"),$(".main-main-in").find("#js-searchcontainer").empty().prepend(a),setTimeout(function(){$("#js-searchcontainer").find(".js-faded").removeClass("js-faded")},300),setFocus("#overlay-search")}).error(function(){})};$("#js-searchinput").on("keyup",function(){if($(this).val().length>2){var a=9,b=getcount("search");b>a&&(b=a+"+"),1==$("#js-searchcount").length?$("#js-searchcount").html("<b>Number of tips found:</b> "+b):$(".overlay-search").find(".form-row").append('<span class="overlay-search-count" id="js-searchcount" tabindex="0"><b>Number of tips found:</b> '+b+"</span>"),searchTips()}}),$("#js-overlay-search-form").submit(function(a){a.preventDefault()});var hideMenu=function(){$(".tip-menu").addClass("is-hidden"),setTimeout(function(){$(".tip-menu").remove()},300),null!=clickedTitle&&clickedTitle.focus(),removeFocus(),$("body").off()},hideMenuOutside=function(a){var b=$(a.target);b.is(".tip-menu")||b.parents().is(".tip-menu")||b.is(".tip-title a")||hideMenu()};$(".main-main-in").on("click",".tip-title > a",function(a){if(clickedTitle=$(this),$(".tip-menu").length>0)hideMenu();else{$("a").attr("tabindex","-1"),$(".tip_version_in").attr("tabindex","-1");var b=$(this).parents(".tip-title").find("> a").text(),c=$(this).parents(".tip-title").find("> a").attr("href");c="sketchtips.info/?tip="+c.substr(5),$(this).parent().append('<div class="tip-menu is-hidden" role="dialog" aria-label="tip-menu-label"><h2 id="tip-menu-label">Options</h2><ul><li class="tip-menu-twit"><a href="#">Tweet this tip</a></li><li class="tip-menu-link">Tip link: <input type="text" class="is-hidden"/></li></ul></div>'),setTimeout(function(){$(".tip-menu").removeClass("is-hidden"),$(".tip-menu-twit a").focus()},300),$(this).parent().find("input").val(c).on("click",function(){$(this).select()}),$(".tip-title").on("click",".tip-menu a",function(){$(this).parent().hasClass("tip-menu-twit")&&(window.location.href="http://twitter.com/home/?status=Check out this Sketch tip at sketchtips.info: '"+b+"' ("+c+")")}),$("body").on("click",function(a){hideMenuOutside(a)}).on("tap",function(a){hideMenuOutside(a)})}a.preventDefault()});